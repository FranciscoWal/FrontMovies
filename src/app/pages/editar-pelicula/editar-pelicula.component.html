<div class="container" style="margin: 20px;">
  <h2>Editar Película</h2>
  <form [formGroup]="peliculaForm" (ngSubmit)="onSubmit()">
    <!-- Nombre -->
    <div class="mb-3">
      <label for="nombre" class="form-label">Nombre</label>
      <input
        type="text"
        class="form-control"
        id="nombre"
        formControlName="nombre"
        [class.is-invalid]="myForm['nombre'].invalid && (myForm['nombre'].touched || enviado)"
      />
      <div *ngIf="myForm['nombre'].hasError('required') && (myForm['nombre'].touched || enviado)" class="invalid-feedback">
        El nombre es obligatorio.
      </div>
    </div>

    <!-- Descripción -->
    <div class="mb-3">
      <label for="descripcion" class="form-label">Descripción</label>
      <textarea
        class="form-control"
        id="descripcion"
        formControlName="descripcion"
        [class.is-invalid]="myForm['descripcion'].invalid && (myForm['descripcion'].touched || enviado)"
      ></textarea>
      <div *ngIf="myForm['descripcion'].hasError('required') && (myForm['descripcion'].touched || enviado)" class="invalid-feedback">
        La descripción es obligatoria.
      </div>
    </div>

    <!-- Trailer Link -->
    <div class="mb-3">
      <label for="trailerLink" class="form-label">Enlace del Trailer (YouTube)</label>
      <input
        type="text"
        class="form-control"
        id="trailerLink"
        formControlName="trailerLink"
        [class.is-invalid]="myForm['trailerLink'].invalid && (myForm['trailerLink'].touched || enviado)"
      />
      <div *ngIf="myForm['trailerLink'].hasError('required') && (myForm['trailerLink'].touched || enviado)" class="invalid-feedback">
        El enlace del trailer es obligatorio.
      </div>
      <div *ngIf="myForm['trailerLink'].hasError('invalidYoutubeUrl') && (myForm['trailerLink'].touched || enviado)" class="invalid-feedback">
        Debe ser un enlace válido de YouTube.
      </div>
    </div>

    <!-- Poster -->
    <div class="mb-3">
      <label for="poster" class="form-label">Poster (Imagen)</label>
      <input
        type="file"
        class="form-control"
        id="poster"
        accept="image/png,image/jpeg,image/gif"
        (change)="onFileChange($event)"
        [class.is-invalid]="myForm['poster'].invalid && (myForm['poster'].touched || enviado)"
      />
      <div *ngIf="myForm['poster'].hasError('required') && (myForm['poster'].touched || enviado)" class="invalid-feedback">
        La imagen es obligatoria.
      </div>
      <div *ngIf="myForm['poster'].hasError('invalidBase64Image') && (myForm['poster'].touched || enviado)" class="invalid-feedback">
        La imagen debe ser un archivo PNG, JPEG o GIF válido.
      </div>
      <!-- Vista previa de la imagen -->
      <img
        *ngIf="peliculaForm.get('poster')?.value"
        [src]="peliculaForm.get('poster')?.value"
        alt="Vista previa"
        style="max-width: 200px; max-height: 300px; margin-top: 10px;"
      />
    </div>

    <!-- Géneros -->
    <div class="mb-3">
      <label class="form-label">Géneros</label>
      <div class="form-check" *ngFor="let genero of generosDisponibles">
        <input
          type="checkbox"
          class="form-check-input"
          [id]="genero"
          [value]="genero"
          (change)="onGenreChange($event, genero)"
          [checked]="peliculaForm.get('genero')?.value.includes(genero)"
        />
        <label class="form-check-label" [for]="genero">{{ genero }}</label>
      </div>
      <div *ngIf="myForm['genero'].hasError('required') && (myForm['genero'].touched || enviado)" class="invalid-feedback d-block">
        Debe seleccionar al menos un género.
      </div>
      <div *ngIf="myForm['genero'].hasError('minGenres') && (myForm['genero'].touched || enviado)" class="invalid-feedback d-block">
        Debe seleccionar al menos {{ myForm['genero'].getError('minGenres').required }} género(s).
      </div>
    </div>

    <!-- Botón de envío -->
    <button type="submit" class="btn btn-primary" [disabled]="peliculaForm.invalid">Actualizar Película</button>
  </form>
</div>